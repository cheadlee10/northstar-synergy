<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NorthStar Synergy | Command Center</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap');
        * { box-sizing: border-box; }
        :root { --bg: #04060f; --card: #080d1a; --border: rgba(255,255,255,0.06); --green: #00d395; --red: #ff3b5c; --blue: #4f8ef7; --amber: #f5a623; --purple: #9b59ff; --text: #e8eaf0; --muted: #4a5568; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; min-height: 100vh; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-track { background: var(--bg); } ::-webkit-scrollbar-thumb { background: #1a2035; border-radius: 2px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; }
        .tab-active { background: rgba(79,142,247,0.15); border-bottom: 2px solid var(--blue); color: var(--blue); }
        .tab-inactive { color: var(--muted); border-bottom: 2px solid transparent; }
        .tab-inactive:hover { color: var(--text); }
        .green { color: var(--green); } .red { color: var(--red); } .blue { color: var(--blue); } .amber { color: var(--amber); } .purple { color: var(--purple); }
        .badge { padding: 2px 8px; border-radius: 20px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge-green { background: rgba(0,211,149,0.15); color: var(--green); }
        .badge-red { background: rgba(255,59,92,0.15); color: var(--red); }
        .badge-blue { background: rgba(79,142,247,0.15); color: var(--blue); }
        .badge-amber { background: rgba(245,166,35,0.15); color: var(--amber); }
        .glow-green { box-shadow: 0 0 20px rgba(0,211,149,0.1); }
        .glow-red { box-shadow: 0 0 20px rgba(255,59,92,0.1); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
        .shimmer { background: linear-gradient(90deg, var(--card) 25%, #0d1530 50%, var(--card) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 10px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; padding: 10px 14px; border-bottom: 1px solid var(--border); }
        td { padding: 11px 14px; font-size: 12px; border-bottom: 1px solid rgba(255,255,255,0.03); }
        tr:hover td { background: rgba(255,255,255,0.02); }
        .metric-label { font-size: 10px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 6px; }
        .metric-value { font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 22px; }
        .metric-sub { font-size: 11px; color: var(--muted); margin-top: 4px; }
    </style>
</head>
<body>
<div id="root"></div>
<script>
const { useState, useEffect, useMemo } = React;
const { AreaChart, Area, BarChart, Bar, LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell, PieChart, Pie, ReferenceLine } = Recharts;

// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fmt = (n, decimals=2) => {
    if (n === undefined || n === null || isNaN(n)) return '$0.00';
    return (n < 0 ? '-$' : '$') + Math.abs(n).toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
};
const fmtPct = (n, decimals=1) => isNaN(n) ? '0.0%' : (n*100).toFixed(decimals)+'%';
const fmtNum = (n) => isNaN(n) ? '0' : Number(n).toLocaleString();
const clamp = (n,min,max) => Math.min(Math.max(n,min),max);

// â”€â”€ SHARED COMPONENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const Spinner = () => React.createElement('div', { style: { padding: '4rem', textAlign: 'center', color: '#4a5568', fontSize: 13 } }, 'Loading...');

const KPICard = ({ label, value, sub, color='var(--text)', border='transparent', raw=false, small=false }) =>
    React.createElement('div', { className: 'card p-5', style: { borderTop: `3px solid ${border}` } },
        React.createElement('div', { className: 'metric-label' }, label),
        React.createElement('div', { className: 'metric-value', style: { color, fontSize: small ? 18 : 22 } }, raw ? value : fmt(value)),
        sub && React.createElement('div', { className: 'metric-sub' }, sub)
    );

const SectionTitle = ({ children }) =>
    React.createElement('div', { style: { fontSize: 10, fontWeight: 700, color: 'var(--muted)', textTransform: 'uppercase', letterSpacing: '0.1em', marginBottom: 14, marginTop: 28 } }, children);

// â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TABS = [
    { id: 'pnl', label: 'P&L Overview', icon: 'â—ˆ' },
    { id: 'kalshi', label: 'âš¡ Kalshi Research', icon: '' },
    { id: 'sports', label: 'Sports Picks', icon: 'ðŸ†' },
    { id: 'john', label: "John's Biz", icon: 'â—†' },
    { id: 'costs', label: 'Cost Drill-Down', icon: 'â–¼' },
    { id: 'ledger', label: 'Ledger', icon: 'â‰¡' },
];

// â”€â”€ P&L OVERVIEW TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PnLTab = ({ d }) => {
    const bettingNet = d.betting_net || 0;
    const wins = d.betting_wins || 0;
    const losses = d.betting_losses || 0;
    const openPos = d.open_positions || 0;
    const exposure = d.open_exposure || 0;
    const winRate = d.win_rate || 0;
    const trades = d.total_trades || 0;
    const apiSpend = d.openrouter_total_spend || 0;
    const creditsLeft = d.openrouter_credits_remaining || 0;
    const totalNet = bettingNet - apiSpend;

    const sparkData = [...Array(14)].map((_,i) => ({ d: `Feb ${i+14}`, v: (Math.random()-0.6)*200 }));

    return React.createElement('div', null,
        // Hero strip
        React.createElement('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(4,1fr)', gap: 12, marginBottom: 12 } },
            React.createElement(KPICard, { label: 'True Net P&L', value: totalNet, color: totalNet>=0?'var(--green)':'var(--red)', border: totalNet>=0?'var(--green)':'var(--red)', sub: 'Betting - API costs' }),
            React.createElement(KPICard, { label: 'Betting Wins', value: wins, color: 'var(--green)', border: 'var(--green)', sub: `${fmtNum(trades)} settled trades` }),
            React.createElement(KPICard, { label: 'Betting Losses', value: losses, color: 'var(--red)', border: 'var(--red)', sub: `${fmtPct(winRate)} win rate` }),
            React.createElement(KPICard, { label: 'Betting Net', value: bettingNet, color: bettingNet>=0?'var(--green)':'var(--red)', border: 'var(--purple)', sub: 'Gross P&L' }),
        ),
        React.createElement('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(4,1fr)', gap: 12, marginBottom: 24 } },
            React.createElement(KPICard, { label: 'Open Positions', value: fmtNum(openPos), color: 'var(--blue)', border: 'var(--blue)', raw: true, sub: 'Active contracts' }),
            React.createElement(KPICard, { label: 'Open Exposure', value: exposure, color: 'var(--amber)', border: 'var(--amber)', sub: 'Capital at risk' }),
            React.createElement(KPICard, { label: 'OpenRouter Spend', value: apiSpend, color: 'var(--amber)', border: 'var(--amber)', sub: `$${creditsLeft.toFixed(2)} remaining` }),
            React.createElement(KPICard, { label: 'Credits Remaining', value: creditsLeft, color: creditsLeft<50?'var(--red)':'var(--green)', border: creditsLeft<50?'var(--red)':'var(--green)', sub: creditsLeft<50?'âš  TOP UP SOON':'Healthy' }),
        ),

        // Business units
        React.createElement(SectionTitle, null, 'Business Units'),
        React.createElement('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(3,1fr)', gap: 12, marginBottom: 24 } },
            [
                { name: 'Scalper / Kalshi', net: bettingNet, rev: wins, color: 'var(--purple)', icon: 'âš¡', detail: `${fmtNum(trades)} trades Â· ${fmtPct(winRate)} win rate Â· ${openPos} open` },
                { name: "John's Web Biz", net: 0, rev: 0, color: 'var(--green)', icon: 'â—†', detail: 'Connect jobs.jsonl to sync' },
                { name: 'Kelsea', net: 0, rev: 0, color: 'var(--amber)', icon: 'âœ¦', detail: 'Awaiting data sync' },
            ].map(seg =>
                React.createElement('div', { key: seg.name, className: 'card p-5', style: { borderLeft: `3px solid ${seg.color}` } },
                    React.createElement('div', { style: { display:'flex', alignItems:'center', gap:8, marginBottom:12 } },
                        React.createElement('span', { style: { color: seg.color, fontSize: 18 } }, seg.icon),
                        React.createElement('span', { style: { fontWeight: 700 } }, seg.name)
                    ),
                    React.createElement('div', { className: 'mono', style: { fontSize: 26, fontWeight: 700, color: seg.net>=0?'var(--green)':'var(--red)', marginBottom: 4 } }, fmt(seg.net)),
                    React.createElement('div', { style: { fontSize: 11, color: 'var(--muted)' } }, 'Wins: ' + fmt(seg.rev)),
                    React.createElement('div', { style: { fontSize: 11, color: 'var(--muted)', marginTop: 4 } }, seg.detail)
                )
            )
        )
    );
};

// â”€â”€ KALSHI RESEARCH TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KalshiTab = ({ d }) => {
    const [trades, setTrades] = useState([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        fetch('/api/kalshi-trades')
            .then(r => r.json())
            .then(data => { setTrades(data.trades || []); setLoading(false); })
            .catch(() => setLoading(false));
    }, []);

    const analytics = useMemo(() => {
        if (!trades.length) return null;
        const settled = trades.filter(t => t.status === 'Settled');
        const open = trades.filter(t => t.status === 'Open');

        const pnl = t => {
            try { return (parseFloat(t.exit_price||0) - parseFloat(t.entry_price||0)) * parseFloat(t.num_contracts||0) - parseFloat(t.fees||0); }
            catch { return 0; }
        };

        const pnls = settled.map(t => ({ ...t, pnl_calc: pnl(t) }));
        const wins = pnls.filter(t => t.pnl_calc > 0);
        const lossArr = pnls.filter(t => t.pnl_calc < 0);
        const totalPnl = pnls.reduce((s,t) => s+t.pnl_calc, 0);
        const winRate = wins.length / Math.max(pnls.length, 1);

        // By market category
        const byMarket = {};
        pnls.forEach(t => {
            const m = t.market || 'Other';
            if (!byMarket[m]) byMarket[m] = { wins:0, losses:0, pnl:0, count:0 };
            byMarket[m].pnl += t.pnl_calc;
            byMarket[m].count++;
            if (t.pnl_calc > 0) byMarket[m].wins++;
            else byMarket[m].losses++;
        });

        // By direction
        const byDir = {};
        pnls.forEach(t => {
            const d = t.direction || 'YES';
            if (!byDir[d]) byDir[d] = { pnl:0, count:0, wins:0 };
            byDir[d].pnl += t.pnl_calc;
            byDir[d].count++;
            if (t.pnl_calc > 0) byDir[d].wins++;
        });

        // Entry price buckets (calibration)
        const buckets = { '0-30':[], '30-50':[], '50-70':[], '70-90':[], '90-100':[] };
        pnls.forEach(t => {
            const p = parseFloat(t.entry_price||0) * 100;
            const key = p<30?'0-30':p<50?'30-50':p<70?'50-70':p<90?'70-90':'90-100';
            buckets[key].push(t.pnl_calc > 0 ? 1 : 0);
        });
        const calibration = Object.entries(buckets).map(([range, outcomes]) => ({
            range,
            actualWinRate: outcomes.length ? outcomes.reduce((a,b)=>a+b,0)/outcomes.length : 0,
            count: outcomes.length
        }));

        // Sharpe (simplified daily)
        const dailyPnl = {};
        pnls.forEach(t => {
            const d = (t.trade_date||'').slice(0,10);
            if (!dailyPnl[d]) dailyPnl[d] = 0;
            dailyPnl[d] += t.pnl_calc;
        });
        const dailyArr = Object.values(dailyPnl);
        const avg = dailyArr.reduce((a,b)=>a+b,0)/Math.max(dailyArr.length,1);
        const std = Math.sqrt(dailyArr.reduce((s,v)=>s+Math.pow(v-avg,2),0)/Math.max(dailyArr.length,1));
        const sharpe = std ? (avg/std)*Math.sqrt(252) : 0;

        // Max drawdown
        let peak = 0, maxDD = 0, running = 0;
        pnls.sort((a,b) => (a.trade_date||'').localeCompare(b.trade_date||'')).forEach(t => {
            running += t.pnl_calc;
            if (running > peak) peak = running;
            const dd = peak - running;
            if (dd > maxDD) maxDD = dd;
        });

        // Kelly criterion (simplified)
        const avgWin = wins.length ? wins.reduce((s,t)=>s+t.pnl_calc,0)/wins.length : 0;
        const avgLoss = lossArr.length ? Math.abs(lossArr.reduce((s,t)=>s+t.pnl_calc,0)/lossArr.length) : 1;
        const kelly = winRate - ((1-winRate)/(avgWin/Math.max(avgLoss,0.01)));

        // Expected value by entry price bucket
        const ev = pnls.reduce((s,t) => {
            const p = parseFloat(t.entry_price||0);
            return s + (t.pnl_calc > 0 ? (1-p)*parseFloat(t.num_contracts||0) : -p*parseFloat(t.num_contracts||0));
        }, 0) / Math.max(pnls.length,1);

        // Cumulative P&L series
        let cum = 0;
        const cumSeries = pnls
            .sort((a,b) => (a.trade_date||'').localeCompare(b.trade_date||''))
            .slice(-90)
            .map((t,i) => { cum += t.pnl_calc; return { i, pnl: parseFloat(cum.toFixed(2)), date: (t.trade_date||'').slice(5,10) }; });

        // Top wins / losses
        const topWins = [...wins].sort((a,b)=>b.pnl_calc-a.pnl_calc).slice(0,5);
        const topLosses = [...lossArr].sort((a,b)=>a.pnl_calc-b.pnl_calc).slice(0,5);

        return { settled, open, pnls, wins, lossArr, totalPnl, winRate, byMarket, byDir, calibration, sharpe, maxDD, kelly, ev, cumSeries, avgWin, avgLoss, topWins, topLosses, dailyArr };
    }, [trades]);

    if (loading) return React.createElement(Spinner);
    if (!analytics) return React.createElement('div', { style: { padding: '2rem', color: 'var(--muted)' } }, 'No trade data found. Run kalshi_sync.py first.');

    const { settled, open, pnls, wins, lossArr, totalPnl, winRate, byMarket, byDir, calibration, sharpe, maxDD, kelly, ev, cumSeries, avgWin, avgLoss, topWins, topLosses } = analytics;

    return React.createElement('div', null,

        // â”€â”€ Top metrics row
        React.createElement('div', { style: { display:'grid', gridTemplateColumns:'repeat(6,1fr)', gap:10, marginBottom:10 } },
            React.createElement('div', { className:'card p-4' },
                React.createElement('div', { className:'metric-label' }, 'Total P&L'),
                React.createElement('div', { className:'metric-value', style:{color:totalPnl>=0?'var(--green)':'var(--red)',fontSize:18} }, fmt(totalPnl))
            ),
            React.createElement('div', { className:'card p-4' },
                React.createElement('div', { className:'metric-label' }, 'Win Rate'),
                React.createElement('div', { className:'metric-value', style:{color:'var(--blue)',fontSize:18} }, fmtPct(winRate)),
                React.createElement('div', { className:'metric-sub' }, `${wins.length}W / ${lossArr.length}L`)
            ),
            React.createElement('div', { className:'card p-4' },
                React.createElement('div', { className:'metric-label' }, 'Sharpe Ratio'),
                React.createElement('div', { className:'metric-value', style:{color:sharpe>=1?'var(--green)':sharpe>=0?'var(--amber)':'var(--red)',fontSize:18} }, sharpe.toFixed(2)),
                React.createElement('div', { className:'metric-sub' }, sharpe>=1?'Strong':'Needs work')
            ),
            React.createElement('div', { className:'card p-4' },
                React.createElement('div', { className:'metric-label' }, 'Max Drawdown'),
                React.createElement('div', { className:'metric-value', style:{color:'var(--red)',fontSize:18} }, fmt(maxDD))
            ),
            React.createElement('div', { className:'card p-4' },
                React.createElement('div', { className:'metric-label' }, 'Kelly %'),
                React.createElement('div', { className:'metric-value', style:{color:kelly>0?'var(--green)':'var(--red)',fontSize:18} }, fmtPct(kelly)),
                React.createElement('div', { className:'metric-sub' }, kelly>0?'Positive edge':'Negative edge')
            ),
            React.createElement('div', { className:'card p-4' },
                React.createElement('div', { className:'metric-label' }, 'Avg Win/Loss'),
                React.createElement('div', { className:'metric-value green', style:{fontSize:14} }, fmt(avgWin)),
                React.createElement('div', { className:'metric-value red', style:{fontSize:14} }, fmt(-avgWin && avgLoss ? -avgLoss : 0))
            ),
        ),

        // â”€â”€ Cumulative P&L chart
        React.createElement(SectionTitle, null, 'Cumulative P&L (Last 90 Trades)'),
        React.createElement('div', { className:'card p-5', style:{marginBottom:12} },
            React.createElement(ResponsiveContainer, { width:'100%', height:180 },
                React.createElement(AreaChart, { data: cumSeries },
                    React.createElement('defs', null,
                        React.createElement('linearGradient', { id:'cumGrad', x1:'0', y1:'0', x2:'0', y2:'1' },
                            React.createElement('stop', { offset:'5%', stopColor: totalPnl>=0?'#00d395':'#ff3b5c', stopOpacity:0.3 }),
                            React.createElement('stop', { offset:'95%', stopColor: totalPnl>=0?'#00d395':'#ff3b5c', stopOpacity:0 })
                        )
                    ),
                    React.createElement(XAxis, { dataKey:'date', tick:{fontSize:10,fill:'#4a5568'}, axisLine:false, tickLine:false }),
                    React.createElement(YAxis, { tick:{fontSize:10,fill:'#4a5568'}, axisLine:false, tickLine:false, tickFormatter:v=>'$'+v }),
                    React.createElement(ReferenceLine, { y:0, stroke:'#4a5568', strokeDasharray:'3 3' }),
                    React.createElement(Tooltip, { contentStyle:{background:'#080d1a',border:'1px solid #1a2035',borderRadius:8,fontSize:11}, formatter:(v)=>['$'+v.toFixed(2),'P&L'] }),
                    React.createElement(Area, { type:'monotone', dataKey:'pnl', stroke:totalPnl>=0?'#00d395':'#ff3b5c', strokeWidth:2, fill:'url(#cumGrad)' })
                )
            )
        ),

        // â”€â”€ By market category + calibration
        React.createElement('div', { style:{display:'grid', gridTemplateColumns:'1fr 1fr', gap:12, marginBottom:12} },

            // Market breakdown
            React.createElement('div', { className:'card p-5' },
                React.createElement('div', { className:'metric-label', style:{marginBottom:12} }, 'P&L by Market Category'),
                React.createElement('table', null,
                    React.createElement('thead', null,
                        React.createElement('tr', null,
                            React.createElement('th', null, 'Market'),
                            React.createElement('th', null, 'Trades'),
                            React.createElement('th', null, 'Win%'),
                            React.createElement('th', null, 'Net P&L'),
                        )
                    ),
                    React.createElement('tbody', null,
                        Object.entries(byMarket)
                            .sort((a,b) => b[1].pnl - a[1].pnl)
                            .map(([market, stats]) =>
                                React.createElement('tr', { key: market },
                                    React.createElement('td', null, React.createElement('span', { className:'mono', style:{fontSize:11} }, market)),
                                    React.createElement('td', null, stats.count),
                                    React.createElement('td', null,
                                        React.createElement('span', { style:{color: stats.wins/stats.count > 0.5 ? 'var(--green)':'var(--red)'} },
                                            fmtPct(stats.wins/Math.max(stats.count,1))
                                        )
                                    ),
                                    React.createElement('td', null,
                                        React.createElement('span', { style:{color: stats.pnl>=0?'var(--green)':'var(--red)', fontFamily:'JetBrains Mono,monospace', fontWeight:700 } },
                                            fmt(stats.pnl)
                                        )
                                    )
                                )
                            )
                    )
                )
            ),

            // Calibration curve
            React.createElement('div', { className:'card p-5' },
                React.createElement('div', { className:'metric-label', style:{marginBottom:4} }, 'Calibration â€” Entry Price vs Actual Win Rate'),
                React.createElement('div', { style:{fontSize:11, color:'var(--muted)', marginBottom:12} }, 'Are you buying at the right prices? Bar = actual win rate at that entry price bucket.'),
                React.createElement(ResponsiveContainer, { width:'100%', height:160 },
                    React.createElement(BarChart, { data: calibration },
                        React.createElement(XAxis, { dataKey:'range', tick:{fontSize:10,fill:'#4a5568'} }),
                        React.createElement(YAxis, { tickFormatter:v=>(v*100).toFixed(0)+'%', tick:{fontSize:10,fill:'#4a5568'}, domain:[0,1] }),
                        React.createElement(Tooltip, { formatter:(v,n,p) => [fmtPct(v), 'Win Rate'], contentStyle:{background:'#080d1a',border:'1px solid #1a2035',fontSize:11} }),
                        React.createElement(Bar, { dataKey:'actualWinRate', radius:[4,4,0,0] },
                            calibration.map((entry,i) =>
                                React.createElement(Cell, { key:i, fill: entry.actualWinRate > 0.5 ? 'var(--green)' : 'var(--red)' })
                            )
                        )
                    )
                )
            )
        ),

        // â”€â”€ Direction analysis + Open positions
        React.createElement('div', { style:{display:'grid', gridTemplateColumns:'1fr 1fr', gap:12, marginBottom:12} },

            React.createElement('div', { className:'card p-5' },
                React.createElement('div', { className:'metric-label', style:{marginBottom:12} }, 'YES vs NO Performance'),
                React.createElement('table', null,
                    React.createElement('thead', null,
                        React.createElement('tr', null,
                            React.createElement('th', null, 'Direction'),
                            React.createElement('th', null, 'Trades'),
                            React.createElement('th', null, 'Win Rate'),
                            React.createElement('th', null, 'Net P&L'),
                        )
                    ),
                    React.createElement('tbody', null,
                        Object.entries(byDir).map(([dir, stats]) =>
                            React.createElement('tr', { key: dir },
                                React.createElement('td', null, React.createElement('span', { className: dir==='YES'?'badge badge-green':'badge badge-red' }, dir)),
                                React.createElement('td', null, stats.count),
                                React.createElement('td', null, React.createElement('span', { style:{color:stats.wins/stats.count>0.5?'var(--green)':'var(--red)'} }, fmtPct(stats.wins/Math.max(stats.count,1)))),
                                React.createElement('td', null, React.createElement('span', { className:'mono', style:{color:stats.pnl>=0?'var(--green)':'var(--red)',fontWeight:700} }, fmt(stats.pnl)))
                            )
                        )
                    )
                )
            ),

            React.createElement('div', { className:'card p-5' },
                React.createElement('div', { className:'metric-label', style:{marginBottom:12} }, `Open Positions (${open.length})`),
                React.createElement('div', { style:{maxHeight:180, overflowY:'auto'} },
                    React.createElement('table', null,
                        React.createElement('thead', null,
                            React.createElement('tr', null,
                                React.createElement('th', null, 'Contract'),
                                React.createElement('th', null, 'Dir'),
                                React.createElement('th', null, 'Entry'),
                                React.createElement('th', null, 'Qty'),
                                React.createElement('th', null, 'Expires'),
                            )
                        ),
                        React.createElement('tbody', null,
                            open.slice(0,10).map((t,i) =>
                                React.createElement('tr', { key:i },
                                    React.createElement('td', { style:{maxWidth:160,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap',fontSize:11} }, t.contract_id || t.market),
                                    React.createElement('td', null, React.createElement('span', { className: t.direction==='YES'?'badge badge-green':'badge badge-red' }, t.direction||'YES')),
                                    React.createElement('td', { className:'mono' }, ((parseFloat(t.entry_price||0))*100).toFixed(0)+'Â¢'),
                                    React.createElement('td', { className:'mono' }, fmtNum(t.num_contracts)),
                                    React.createElement('td', { style:{fontSize:10,color:'var(--muted)'} }, (t.expiry_date||'').slice(5,10))
                                )
                            )
                        )
                    )
                )
            )
        ),

        // â”€â”€ Top 5 wins and losses
        React.createElement('div', { style:{display:'grid', gridTemplateColumns:'1fr 1fr', gap:12} },
            React.createElement('div', { className:'card p-5' },
                React.createElement('div', { className:'metric-label green', style:{marginBottom:12} }, 'Top 5 Wins'),
                React.createElement('table', null,
                    React.createElement('thead', null,
                        React.createElement('tr', null,
                            React.createElement('th', null, 'Market'), React.createElement('th', null, 'Entry'), React.createElement('th', null, 'P&L')
                        )
                    ),
                    React.createElement('tbody', null,
                        topWins.map((t,i) =>
                            React.createElement('tr', { key:i },
                                React.createElement('td', { style:{fontSize:11} }, t.market),
                                React.createElement('td', { className:'mono', style:{fontSize:11} }, ((parseFloat(t.entry_price||0))*100).toFixed(0)+'Â¢'),
                                React.createElement('td', { className:'mono green', style:{fontWeight:700} }, '+'+fmt(t.pnl_calc))
                            )
                        )
                    )
                )
            ),
            React.createElement('div', { className:'card p-5' },
                React.createElement('div', { className:'metric-label red', style:{marginBottom:12} }, 'Top 5 Losses'),
                React.createElement('table', null,
                    React.createElement('thead', null,
                        React.createElement('tr', null,
                            React.createElement('th', null, 'Market'), React.createElement('th', null, 'Entry'), React.createElement('th', null, 'P&L')
                        )
                    ),
                    React.createElement('tbody', null,
                        topLosses.map((t,i) =>
                            React.createElement('tr', { key:i },
                                React.createElement('td', { style:{fontSize:11} }, t.market),
                                React.createElement('td', { className:'mono', style:{fontSize:11} }, ((parseFloat(t.entry_price||0))*100).toFixed(0)+'Â¢'),
                                React.createElement('td', { className:'mono red', style:{fontWeight:700} }, fmt(t.pnl_calc))
                            )
                        )
                    )
                )
            )
        )
    );
};

// â”€â”€ SPORTS PICKS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SportsTab = () =>
    React.createElement('div', { className:'card p-8', style:{textAlign:'center',color:'var(--muted)'} },
        React.createElement('div', { style:{fontSize:32,marginBottom:12} }, 'ðŸ†'),
        React.createElement('div', { style:{fontSize:14,fontWeight:600,marginBottom:8} }, 'Sports Picks'),
        React.createElement('div', { style:{fontSize:12} }, 'Connect pick_performance_log.jsonl from Scalper workspace to populate.')
    );

// â”€â”€ JOHN TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const JohnTab = () =>
    React.createElement('div', { className:'card p-8', style:{textAlign:'center',color:'var(--muted)'} },
        React.createElement('div', { style:{fontSize:32,marginBottom:12} }, 'â—†'),
        React.createElement('div', { style:{fontSize:14,fontWeight:600,marginBottom:8} }, "John's Web Biz"),
        React.createElement('div', { style:{fontSize:12} }, 'Connect jobs.jsonl and leads.jsonl from John workspace to populate.')
    );

// â”€â”€ COSTS TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CostsTab = ({ d }) => {
    const apiSpend = d.openrouter_total_spend || 0;
    const creditsLeft = d.openrouter_credits_remaining || 0;
    const totalCredits = apiSpend + creditsLeft;
    const pctUsed = apiSpend / Math.max(totalCredits, 1);

    return React.createElement('div', null,
        React.createElement(SectionTitle, null, 'API Cost Analysis'),
        React.createElement('div', { style:{display:'grid', gridTemplateColumns:'repeat(3,1fr)', gap:12, marginBottom:24} },
            React.createElement(KPICard, { label:'Total Spent', value:apiSpend, color:'var(--red)', border:'var(--red)' }),
            React.createElement(KPICard, { label:'Credits Left', value:creditsLeft, color:creditsLeft<50?'var(--red)':'var(--green)', border:creditsLeft<50?'var(--red)':'var(--green)' }),
            React.createElement(KPICard, { label:'% Credits Used', value:fmtPct(pctUsed), color:'var(--amber)', border:'var(--amber)', raw:true }),
        ),
        React.createElement('div', { className:'card p-5' },
            React.createElement('div', { className:'metric-label', style:{marginBottom:12} }, 'Credit Usage'),
            React.createElement('div', { style:{height:12, background:'#1a2035', borderRadius:6, overflow:'hidden'} },
                React.createElement('div', { style:{height:'100%', width:fmtPct(pctUsed), background: pctUsed>0.9?'var(--red)':pctUsed>0.7?'var(--amber)':'var(--green)', borderRadius:6, transition:'width 0.5s'} })
            ),
            React.createElement('div', { style:{display:'flex', justifyContent:'space-between', marginTop:8, fontSize:11, color:'var(--muted)'} },
                React.createElement('span', null, '$0'),
                React.createElement('span', null, fmt(totalCredits) + ' total')
            ),
            creditsLeft < 50 && React.createElement('div', { style:{marginTop:12, padding:'10px 14px', background:'rgba(255,59,92,0.1)', border:'1px solid rgba(255,59,92,0.3)', borderRadius:8, fontSize:12, color:'var(--red)', fontWeight:600} },
                'âš  Only $' + creditsLeft.toFixed(2) + ' remaining on OpenRouter. Top up to keep agents running.'
            )
        )
    );
};

// â”€â”€ LEDGER TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LedgerTab = () => {
    const [trades, setTrades] = useState([]);
    const [loading, setLoading] = useState(true);
    const [page, setPage] = useState(0);
    const PER_PAGE = 25;

    useEffect(() => {
        fetch('/api/kalshi-trades')
            .then(r => r.json())
            .then(data => { setTrades(data.trades || []); setLoading(false); })
            .catch(() => setLoading(false));
    }, []);

    if (loading) return React.createElement(Spinner);

    const settled = trades.filter(t => t.status === 'Settled');
    const paginated = settled.slice(page*PER_PAGE, (page+1)*PER_PAGE);
    const totalPages = Math.ceil(settled.length/PER_PAGE);

    return React.createElement('div', null,
        React.createElement('div', { style:{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:12} },
            React.createElement('div', { style:{fontSize:12, color:'var(--muted)'} }, `${fmtNum(settled.length)} settled trades`),
            React.createElement('div', { style:{display:'flex', gap:8, alignItems:'center'} },
                React.createElement('button', { onClick:()=>setPage(Math.max(0,page-1)), disabled:page===0, style:{padding:'4px 12px', background:'#080d1a', border:'1px solid #1a2035', borderRadius:6, color:page===0?'#4a5568':'var(--text)', cursor:page===0?'default':'pointer', fontSize:12} }, 'â†'),
                React.createElement('span', { style:{fontSize:11, color:'var(--muted)'} }, `${page+1} / ${totalPages}`),
                React.createElement('button', { onClick:()=>setPage(Math.min(totalPages-1,page+1)), disabled:page>=totalPages-1, style:{padding:'4px 12px', background:'#080d1a', border:'1px solid #1a2035', borderRadius:6, color:page>=totalPages-1?'#4a5568':'var(--text)', cursor:page>=totalPages-1?'default':'pointer', fontSize:12} }, 'â†’')
            )
        ),
        React.createElement('div', { className:'card', style:{overflowX:'auto'} },
            React.createElement('table', null,
                React.createElement('thead', null,
                    React.createElement('tr', null,
                        React.createElement('th', null, 'Date'),
                        React.createElement('th', null, 'Market'),
                        React.createElement('th', null, 'Contract'),
                        React.createElement('th', null, 'Dir'),
                        React.createElement('th', null, 'Entry'),
                        React.createElement('th', null, 'Exit'),
                        React.createElement('th', null, 'Qty'),
                        React.createElement('th', null, 'Fees'),
                        React.createElement('th', null, 'P&L'),
                    )
                ),
                React.createElement('tbody', null,
                    paginated.map((t,i) => {
                        const pnl = (parseFloat(t.exit_price||0)-parseFloat(t.entry_price||0))*parseFloat(t.num_contracts||0)-parseFloat(t.fees||0);
                        return React.createElement('tr', { key:i },
                            React.createElement('td', { className:'mono', style:{fontSize:11,color:'var(--muted)'} }, (t.trade_date||'').slice(0,10)),
                            React.createElement('td', null, React.createElement('span', { className:'badge badge-blue' }, t.market||'Other')),
                            React.createElement('td', { style:{fontSize:11,maxWidth:200,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'} }, t.contract_id),
                            React.createElement('td', null, React.createElement('span', { className:t.direction==='YES'?'badge badge-green':'badge badge-red' }, t.direction||'YES')),
                            React.createElement('td', { className:'mono', style:{fontSize:11} }, ((parseFloat(t.entry_price||0))*100).toFixed(0)+'Â¢'),
                            React.createElement('td', { className:'mono', style:{fontSize:11} }, ((parseFloat(t.exit_price||0))*100).toFixed(0)+'Â¢'),
                            React.createElement('td', { className:'mono', style:{fontSize:11} }, fmtNum(t.num_contracts)),
                            React.createElement('td', { className:'mono', style:{fontSize:11,color:'var(--muted)'} }, fmt(parseFloat(t.fees||0))),
                            React.createElement('td', { className:'mono', style:{fontWeight:700,color:pnl>=0?'var(--green)':'var(--red)'} }, (pnl>=0?'+':'')+fmt(pnl))
                        );
                    })
                )
            )
        )
    );
};

// â”€â”€ ROOT APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const App = () => {
    const [tab, setTab] = useState('pnl');
    const [data, setData] = useState(null);
    const [error, setError] = useState(null);
    const [lastUpdated, setLastUpdated] = useState(null);

    const loadData = () => {
        fetch('/api/dashboard')
            .then(r => { if(!r.ok) throw new Error(r.status); return r.json(); })
            .then(d => { setData(d); setLastUpdated(new Date().toLocaleTimeString()); setError(null); })
            .catch(e => setError(e.toString()));
    };

    useEffect(() => { loadData(); const iv = setInterval(loadData, 60000); return ()=>clearInterval(iv); }, []);

    const tabContent = () => {
        if (!data && tab !== 'sports' && tab !== 'john') return React.createElement(Spinner);
        switch(tab) {
            case 'pnl': return React.createElement(PnLTab, { d: data });
            case 'kalshi': return React.createElement(KalshiTab, { d: data });
            case 'sports': return React.createElement(SportsTab);
            case 'john': return React.createElement(JohnTab);
            case 'costs': return React.createElement(CostsTab, { d: data });
            case 'ledger': return React.createElement(LedgerTab);
            default: return null;
        }
    };

    return React.createElement('div', { style:{minHeight:'100vh'} },

        // â”€â”€ HEADER
        React.createElement('div', { style:{background:'rgba(4,6,15,0.95)', backdropFilter:'blur(16px)', borderBottom:'1px solid var(--border)', position:'sticky', top:0, zIndex:50} },
            React.createElement('div', { style:{maxWidth:1400, margin:'0 auto', padding:'0 24px'} },
                React.createElement('div', { style:{display:'flex', justifyContent:'space-between', alignItems:'center', paddingTop:14, paddingBottom:0} },
                    React.createElement('div', { style:{display:'flex', alignItems:'center', gap:12} },
                        React.createElement('div', { style:{width:36,height:36,borderRadius:10,background:'linear-gradient(135deg,#4f8ef7,#9b59ff)',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:900,fontSize:14,color:'white',fontFamily:'JetBrains Mono'} }, 'NS'),
                        React.createElement('div', null,
                            React.createElement('div', { style:{fontWeight:800,fontSize:16,letterSpacing:'-0.02em'} }, 'NorthStar Synergy'),
                            React.createElement('div', { style:{fontSize:9,color:'var(--muted)',textTransform:'uppercase',letterSpacing:'0.1em',fontWeight:600} }, 'Intelligence Â· Operations Â· Profit')
                        )
                    ),
                    React.createElement('div', { style:{display:'flex', alignItems:'center', gap:16} },
                        error && React.createElement('span', { style:{fontSize:11,color:'var(--red)'} }, 'âš  API Error'),
                        lastUpdated && React.createElement('span', { style:{fontSize:10,color:'var(--muted)'} }, 'Updated ' + lastUpdated),
                        React.createElement('div', { style:{display:'flex',alignItems:'center',gap:6} },
                            React.createElement('div', { className:'pulse', style:{width:7,height:7,borderRadius:'50%',background:'var(--green)'} }),
                            React.createElement('span', { style:{fontSize:10,fontWeight:700,color:'var(--green)'} }, 'LIVE')
                        )
                    )
                ),

                // Tab bar
                React.createElement('div', { style:{display:'flex', gap:2, marginTop:4} },
                    TABS.map(t =>
                        React.createElement('button', {
                            key: t.id,
                            onClick: () => setTab(t.id),
                            className: tab===t.id ? 'tab-active' : 'tab-inactive',
                            style:{
                                padding:'10px 16px',
                                fontSize:12,
                                fontWeight:600,
                                background:'none',
                                border:'none',
                                borderBottom: tab===t.id ? '2px solid var(--blue)' : '2px solid transparent',
                                color: tab===t.id ? 'var(--blue)' : 'var(--muted)',
                                cursor:'pointer',
                                transition:'all 0.15s',
                                whiteSpace:'nowrap'
                            }
                        }, t.label)
                    )
                )
            )
        ),

        // â”€â”€ CONTENT
        React.createElement('div', { style:{maxWidth:1400, margin:'0 auto', padding:'24px'} },
            tabContent()
        )
    );
};

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>